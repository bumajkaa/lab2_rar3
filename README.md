# lab2_rar3
Пример запуска:  
python gen.py <файл> <пароль> [выходной_файл]  
python gen.py test.txt 999 t.rar  
python gen.py test.txt 999


python crack.py <файл> <маска> [кол-во потоков]  
python crack.py test.txt.rar ddd  
python crack.py test.txt.rar ddd 12


Как работает шифрование и расшифрование в RAR3  
Процесс шифрования  
Шаг 1: Подготовка пароля и соли  
Программа берёт пароль и преобразует его в байты в формате UTF-16LE, где каждый символ занимает 2 байта. Затем генерируется случайная "соль" — 8 случайных байт.  
Шаг 2: Создание ключа и IV  
Здесь начинается самая сложная часть. Программа запускает специальную функцию (KDF), которая 262 144 раза пропускает пароль и соль через алгоритм SHA-1. В результате получаются:
- Ключ шифрования (16 байт)  
- Инициализирующий вектор (IV) (16 байт)


Шаг 3: Подготовка данных к шифрованию  
Файл готовится к шифрованию. Если используется сжатие PPMd (один из методов в RAR3), то в начало данных автоматически добавляется специальный заголовок. Этот заголовок всегда одинаков для PPMd — это последовательность байт `c4 3d 7b 00 40 07 00 00...`  
Шаг 4: Шифрование  
Данные разбиваются на блоки по 16 байт и шифруются алгоритмом AES-128 в режиме CBC. Каждый следующий блок зависит от предыдущего, что делает шифрование более надёжным. В конце добавляется padding (дополнительные байты), чтобы общий размер был кратен 16.  
Шаг 5: Сохранение  
В файл записывается: сначала соль (8 байт, открыто), затем все зашифрованные данные. Ключ и IV не сохраняются — они вычисляются из пароля при необходимости.  

Процесс расшифрования  
Шаг 1: Чтение соли  
Программа читает первые 8 байт файла — это соль, которая хранится открыто.  
Шаг 2: Запрос пароля  
Генерируется пароль по маске. Программа преобразует его в UTF-16LE и объединяет с солью.  
Шаг 3: Восстановление ключа и IV  
Запускается та же самая функция KDF с теми же 262 144 итерациями SHA-1. Из пароля и соли вычисляются ключ и IV. Если пароль правильный — получатся те же самые ключ и IV, что и при шифровании. Если пароль неверный — получатся совершенно другие значения.  
Шаг 4: Расшифрование 
Программа расшифровывает первые 32-48 байт зашифрованных данных (а не весь файл!). Она использует вычисленные ключ и IV для обратного преобразования AES-CBC.  
Шаг 5: Проверка правильности пароля  
После расшифрования программа смотрит на начало полученных данных. Если там находится ожидаемый заголовок метода сжатия (например, `c4 3d 7b 00 40 07...` для PPMd), значит:  
1. Ключ и IV были вычислены правильно
2. Следовательно, пароль верный!
